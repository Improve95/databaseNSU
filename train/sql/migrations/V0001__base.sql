create table routes (
    id int primary key generated by default as identity,
    name varchar(100) not null
);

create table stations (
    id int primary key generated by default as identity,
    name varchar(100) not null
);

create table routes_info (
    id int primary key generated by default as identity,
    route int references routes(id),
    station int references stations(id),
    constraint route_station unique (route, station),
    arrival_time time,
    departure_time time,
    distance int not null default (random() * 100),
    arrival_delay interval minute default '0 minutes',
    departure_delay interval minute default '0 minutes'
);

create type trains_category as enum('c1', 'c2', 'c3');
create table trains (
    id int primary key generated by default as identity,
    category trains_category not null default 'c1'::trains_category,
    header_station int references stations(id)
);

create type railroad_cars_category as enum('c1', 'c2', 'c3');
create table railroad_cars (
    id int primary key generated by default as identity,
    category railroad_cars_category not null default 'c3'::railroad_cars_category,
    train int references trains(id),
    number int not null default 0
);

create table trains_routes (
    route int references routes(id) not null,
    train int references trains(id) not null,
    setup_time timestamp not null default current_timestamp,
    remove_time timestamp
);

create table passengers (
    id int primary key generated by default as identity,
    name varchar(100) not null,
    passport_series int not null,
    passport_number int not null,
    constraint passengers_passport unique (passport_number, passport_series)
);

create table booking (
    id int primary key generated by default as identity,
--     railroad_car_booking int references railroads_cars_booking(id) not null,
    passenger int references passengers(id) not null,
    time timestamp not null default current_timestamp
);

create table railroads_cars_booking (
    id int primary key generated by default as identity,
    railroad_car int references railroad_cars(id) not null,
    route_info int references routes_info not null,
    place int not null,
    constraint booking_place unique (railroad_car, route_info, place),
    booking_info int references booking(id) not null
);

create type staff_position as enum ('p1', 'p2', 'p3');
create table staff (
    id int primary key generated by default as identity ,
    name varchar(50) not null,
    passport_series int not null,
    passport_number int not null,
    constraint staff_passport unique (passport_number, passport_series),
    position staff_position default 'p1'::staff_position,
    manager_id int default null,
    foreign key (manager_id) references staff("id") deferrable initially immediate
);
